//https://script.google.com/macros/s/AKfycbzSfFumXtSssDw9oEyVO8DOgXQ6N91J7hr4loIstFbBtg15rQ0A8AR28Tnl6YN4aWA7/exec


const SHEETURL ="https://docs.google.com/spreadsheets/d/1ouvob-GX2H5yfe_BsgNqXtc4xOHjcacjePByn-yWhzc/edit#gid=0";
const SHEET_NAME = "Sheet1";

const doGet = () => {
  const sheet =SpreadsheetApp.openByUrl(SHEETURL).getSheetByName(SHEET_NAME);
  const [header, ...data] = sheet.getDataRange().getDisplayValues();
  
  const PHONE = header.indexOf('Phone');
  const TEXT = header.indexOf('Text');
  const STATUS = header.indexOf('Status');

  const output = [];

  data.forEach((row, index) => {
    if (row[STATUS] === '') {
      output.push([index + 1, row[PHONE], row[TEXT]]);
    }
  });

  const json = JSON.stringify(output);

  return ContentService.createTextOutput(json).setMimeType(ContentService.MimeType.TEXT);
};

const doPost = (e) => {
  const sheet = SpreadsheetApp.openByUrl(SHEETURL).getSheetByName(SHEET_NAME);
  const [header] = sheet.getRange('A1:1').getValues();
  const STATUS = header.indexOf('Status');
  var rowId = Number(e.parameter.row);
  sheet.getRange(rowId + 1, STATUS + 1).setValue('SMS Sent');
  return ContentService.createTextOutput('').setMimeType(ContentService.MimeType.TEXT);
};